<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IrsanAI-LRP v1.3</title>
  <style>
    :root {
      --bg: #0b1020;
      --panel: rgba(20, 28, 52, 0.72);
      --panel-strong: #111a33;
      --text: #eaf0ff;
      --muted: #99a8d4;
      --primary: #7f8cff;
      --primary-2: #31d1ff;
      --success: #2ecc71;
      --warn: #f6c244;
      --danger: #ff6b7d;
      --border: rgba(127, 140, 255, 0.25);
      --shadow: 0 18px 45px rgba(0, 0, 0, 0.35);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: Inter, Segoe UI, system-ui, -apple-system, sans-serif;
      min-height: 100vh;
      color: var(--text);
      background:
        radial-gradient(circle at 15% 20%, rgba(49, 209, 255, 0.25), transparent 38%),
        radial-gradient(circle at 85% 10%, rgba(127, 140, 255, 0.28), transparent 40%),
        linear-gradient(155deg, #070b17 0%, #0b1020 55%, #11162a 100%);
      padding: 28px;
    }

    .container { max-width: 1360px; margin: 0 auto; }
    .hero {
      border: 1px solid var(--border);
      border-radius: 20px;
      background: linear-gradient(160deg, rgba(17, 26, 51, 0.9), rgba(13, 21, 42, 0.88));
      box-shadow: var(--shadow);
      padding: 24px;
      margin-bottom: 20px;
    }

    .hero-top { display: flex; justify-content: space-between; gap: 16px; flex-wrap: wrap; align-items: center; }
    h1 { font-size: clamp(1.7rem, 3vw, 2.4rem); margin-bottom: 8px; }
    .subtitle { color: var(--muted); line-height: 1.5; max-width: 860px; }

    .pill-row { margin-top: 14px; display: flex; flex-wrap: wrap; gap: 8px; }
    .pill { border: 1px solid var(--border); color: #d9e2ff; padding: 6px 12px; border-radius: 999px; font-size: 0.86rem; background: rgba(127, 140, 255, 0.12); }

    .lang-control {
      display: grid;
      gap: 8px;
      min-width: 255px;
      background: rgba(127,140,255,0.08);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
    }

    .lang-control label { font-size: 0.85rem; color: var(--muted); }

    select, textarea, input[type="range"] {
      width: 100%;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: rgba(8, 13, 27, 0.8);
      color: var(--text);
    }

    select { padding: 10px; }

    .main-grid { display: grid; gap: 20px; grid-template-columns: 1.1fr 0.9fr; }
    @media (max-width: 1120px) { .main-grid { grid-template-columns: 1fr; } }

    .card {
      border: 1px solid var(--border);
      background: var(--panel);
      border-radius: 18px;
      padding: 20px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }

    .card h2 { font-size: 1.16rem; margin-bottom: 12px; }
    .helper { color: var(--muted); font-size: 0.92rem; margin-bottom: 12px; }

    textarea { min-height: 220px; padding: 14px; resize: vertical; line-height: 1.5; }

    .metrics { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 12px; }
    .metric { border: 1px solid var(--border); border-radius: 12px; padding: 12px; text-align: center; background: rgba(13, 19, 38, 0.9); }
    .metric b { display: block; font-size: 1.2rem; color: #e8ecff; }
    .metric span { color: var(--muted); font-size: 0.84rem; }

    .controls-grid { display: grid; gap: 12px; }
    .llm-grid { display: grid; gap: 10px; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); }
    .llm-btn {
      border: 1px solid var(--border);
      background: rgba(8, 13, 27, 0.9);
      color: var(--text);
      padding: 10px;
      border-radius: 12px;
      cursor: pointer;
      text-align: left;
    }
    .llm-btn.active { border-color: var(--primary-2); box-shadow: inset 0 0 0 1px var(--primary-2); }
    .toggles { display: grid; gap: 8px; }
    .toggle { display: flex; gap: 10px; align-items: flex-start; border: 1px solid var(--border); padding: 10px; border-radius: 12px; background: rgba(8, 13, 27, 0.76); }
    .toggle small { color: var(--muted); display: block; }

    .btn-row { display: grid; gap: 10px; margin-top: 14px; }
    button.primary, button.secondary {
      border: none;
      border-radius: 12px;
      padding: 12px 16px;
      font-weight: 700;
      cursor: pointer;
      transition: transform .2s ease;
    }
    button.primary:hover, button.secondary:hover { transform: translateY(-1px); }
    button.primary { color: #061122; background: linear-gradient(90deg, var(--primary-2), #8ea1ff); }
    button.secondary { color: #fff; background: linear-gradient(95deg, #667eea, #8d4eff); }

    .analysis-box { border: 1px solid var(--border); border-radius: 12px; padding: 14px; background: rgba(8,13,27,.72); min-height: 152px; }
    .progress { height: 8px; background: rgba(255,255,255,0.08); border-radius: 999px; overflow: hidden; margin: 8px 0; }
    .progress > div { height: 100%; background: linear-gradient(90deg, #42e695, #3bb2ff); }
    .list { margin-left: 18px; margin-top: 8px; color: #d9e2ff; }

    .output-card { margin-top: 20px; }
    .output { white-space: pre-wrap; word-break: break-word; max-height: 560px; overflow: auto; border: 1px solid var(--border); border-radius: 14px; padding: 16px; background: #080d1c; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; line-height: 1.45; }
    .output-toolbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; gap: 10px; flex-wrap: wrap; }
    .muted { color: var(--muted); font-size: .88rem; }
  </style>
</head>
<body>
  <div class="container">
    <section class="hero">
      <div class="hero-top">
        <div>
          <h1>üöÄ IrsanAI ¬∑ LRP v1.3</h1>
          <p class="subtitle">Business-orientierter Prompt-Generator mit Resonance-Check, strukturierter Layer-Logik und mehrsprachiger Protokollausgabe.</p>
          <div class="pill-row">
            <span class="pill">Resonance Echo</span>
            <span class="pill">Context ¬∑ Task ¬∑ Constraints ¬∑ Output Format</span>
            <span class="pill">Token-aware</span>
            <span class="pill">Multi-LLM Ready</span>
          </div>
        </div>
        <div class="lang-control">
          <label for="language">Ausgabesprache des LRP-Protokolls</label>
          <select id="language"></select>
        </div>
      </div>
    </section>

    <div class="main-grid">
      <section class="card">
        <h2>1) Anfrage eingeben</h2>
        <p class="helper">Beschreibe dein Ziel m√∂glichst konkret. Das LRP wird beim Generieren in der gew√§hlten Sprache erzeugt.</p>
        <textarea id="userPrompt" placeholder="Beispiel: Erstelle ein Konzept f√ºr ein B2B SaaS Onboarding-Flow mit KPI-Metriken, Constraints und klaren Deliverables."></textarea>
        <div class="metrics">
          <div class="metric"><b id="charCount">0</b><span>Zeichen</span></div>
          <div class="metric"><b id="tokenEstimate">0</b><span>‚âà Tokens</span></div>
          <div class="metric"><b id="complexity">-</b><span>Komplexit√§t</span></div>
        </div>
      </section>

      <section class="card">
        <h2>2) Konfiguration & Analyse</h2>
        <div class="controls-grid">
          <div>
            <p class="helper">LLM-Ziel</p>
            <div class="llm-grid" id="llmOptions"></div>
          </div>
          <div class="toggles">
            <label class="toggle"><input type="checkbox" id="intentConfidence" checked /><div><strong>Intent-Confidence</strong><small>Gibt einen Confidence-Score im Protokoll aus.</small></div></label>
            <label class="toggle"><input type="checkbox" id="tokenOptimization" checked /><div><strong>Token-Optimierung</strong><small>MINI/FULL Pre-Selector abh√§ngig von Prompt-L√§nge.</small></div></label>
            <label class="toggle"><input type="checkbox" id="emergencyFallback" checked /><div><strong>Emergency Fallback</strong><small>Sicherer Fallback-Block bei Inkompatibilit√§ten.</small></div></label>
            <label class="toggle"><input type="checkbox" id="versionCheck" /><div><strong>Version-Check</strong><small>Hinweis auf Protokollversion bei Bedarf.</small></div></label>
          </div>
          <div>
            <p class="helper">Token-Budget: <b id="tokenValue">2000</b></p>
            <input type="range" id="tokenBudget" min="500" max="5000" step="100" value="2000" />
          </div>
          <div class="analysis-box" id="analysisResult">Analyse wartet auf Eingabe‚Ä¶</div>
          <div class="btn-row">
            <button class="primary" onclick="analyzePrompt()">üîç Analyse starten</button>
            <button class="secondary" onclick="generateLRP()">‚ö° LRP-Protokoll generieren</button>
          </div>
        </div>
      </section>
    </div>

    <section class="card output-card">
      <div class="output-toolbar">
        <h2>3) Generiertes LRP-Protokoll</h2>
        <button class="primary" onclick="copyToClipboard()">üìã Kopieren</button>
      </div>
      <p class="muted">Die Ausgabe enth√§lt jetzt immer Core Components + Resonance Check und wird in der gew√§hlten Zielsprache aufgebaut.</p>
      <div class="output" id="output">Hier erscheint dein generiertes LRP-Protokoll‚Ä¶</div>
    </section>
  </div>

  <script>
    const LANGUAGES = {
      de: { label: "üá©üá™ Deutsch", protocolTitle: "IrsanAI-LRP v1.3 ‚Äì Protokoll", auto: "Automatisch erzeugtes LRP-Dokument", metadata: "METADATEN", userRequest: "NUTZER-ANFRAGE", components: "CORE COMPONENTS", resonance: "RESONANCE CHECK", instructions: "SYSTEMANWEISUNGEN", fallback: "EMERGENCY FALLBACK", quality: "QUALIT√ÑTSKRITERIEN", responseLang: "Antworte auf DEUTSCH.", complexity: ["Niedrig","Mittel","Hoch"] },
      en: { label: "üá¨üáß English", protocolTitle: "IrsanAI-LRP v1.3 ‚Äì Protocol", auto: "Automatically generated LRP document", metadata: "METADATA", userRequest: "USER REQUEST", components: "CORE COMPONENTS", resonance: "RESONANCE CHECK", instructions: "SYSTEM INSTRUCTIONS", fallback: "EMERGENCY FALLBACK", quality: "QUALITY CRITERIA", responseLang: "Respond in ENGLISH.", complexity: ["Low","Medium","High"] },
      es: { label: "üá™üá∏ Espa√±ol", protocolTitle: "IrsanAI-LRP v1.3 ‚Äì Protocolo", auto: "Documento LRP generado autom√°ticamente", metadata: "METADATOS", userRequest: "SOLICITUD DEL USUARIO", components: "COMPONENTES CLAVE", resonance: "VERIFICACI√ìN DE RESONANCIA", instructions: "INSTRUCCIONES DEL SISTEMA", fallback: "FALLBACK DE EMERGENCIA", quality: "CRITERIOS DE CALIDAD", responseLang: "Responde en ESPA√ëOL.", complexity: ["Baja","Media","Alta"] },
      it: { label: "üáÆüáπ Italiano", protocolTitle: "IrsanAI-LRP v1.3 ‚Äì Protocollo", auto: "Documento LRP generato automaticamente", metadata: "METADATI", userRequest: "RICHIESTA UTENTE", components: "COMPONENTI CORE", resonance: "CONTROLLO DI RISONANZA", instructions: "ISTRUZIONI DI SISTEMA", fallback: "FALLBACK DI EMERGENZA", quality: "CRITERI DI QUALIT√Ä", responseLang: "Rispondi in ITALIANO.", complexity: ["Bassa","Media","Alta"] },
      bs: { label: "üáßüá¶ Bosanski", protocolTitle: "IrsanAI-LRP v1.3 ‚Äì Protokol", auto: "Automatski generisan LRP dokument", metadata: "METAPODACI", userRequest: "KORISNIƒåKI ZAHTJEV", components: "KLJUƒåNE KOMPONENTE", resonance: "PROVJERA REZONANCE", instructions: "SISTEMSKE UPUTE", fallback: "HITNI FALLBACK", quality: "KRITERIJI KVALITETE", responseLang: "Odgovori na BOSANSKOM.", complexity: ["Niska","Srednja","Visoka"] },
      ru: { label: "üá∑üá∫ –†—É—Å—Å–∫–∏–π", protocolTitle: "IrsanAI-LRP v1.3 ‚Äî –ü—Ä–æ—Ç–æ–∫–æ–ª", auto: "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç LRP", metadata: "–ú–ï–¢–ê–î–ê–ù–ù–´–ï", userRequest: "–ó–ê–ü–†–û–° –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø", components: "–ö–õ–Æ–ß–ï–í–´–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´", resonance: "–ü–†–û–í–ï–†–ö–ê –†–ï–ó–û–ù–ê–ù–°–ê", instructions: "–°–ò–°–¢–ï–ú–ù–´–ï –ò–ù–°–¢–†–£–ö–¶–ò–ò", fallback: "–ê–í–ê–†–ò–ô–ù–´–ô FALLBACK", quality: "–ö–†–ò–¢–ï–†–ò–ò –ö–ê–ß–ï–°–¢–í–ê", responseLang: "–û—Ç–≤–µ—á–∞–π –Ω–∞ –†–£–°–°–ö–û–ú.", complexity: ["–ù–∏–∑–∫–∞—è","–°—Ä–µ–¥–Ω—è—è","–í—ã—Å–æ–∫–∞—è"] },
      zh: { label: "üá®üá≥ ‰∏≠Êñá", protocolTitle: "IrsanAI-LRP v1.3 ‚Äî ÂçèËÆÆ", auto: "Ëá™Âä®ÁîüÊàêÁöÑ LRP ÊñáÊ°£", metadata: "ÂÖÉÊï∞ÊçÆ", userRequest: "Áî®Êà∑ËØ∑Ê±Ç", components: "Ê†∏ÂøÉÁªÑ‰ª∂", resonance: "ÂÖ±ÊåØÊ£ÄÊü•", instructions: "Á≥ªÁªüÊåá‰ª§", fallback: "Á¥ßÊÄ•ÂõûÈÄÄ", quality: "Ë¥®ÈáèÊ†áÂáÜ", responseLang: "ËØ∑Áî®‰∏≠ÊñáÂõûÁ≠î„ÄÇ", complexity: ["‰Ωé","‰∏≠","È´ò"] },
      fr: { label: "üá´üá∑ Fran√ßais", protocolTitle: "IrsanAI-LRP v1.3 ‚Äì Protocole", auto: "Document LRP g√©n√©r√© automatiquement", metadata: "M√âTADONN√âES", userRequest: "DEMANDE UTILISATEUR", components: "COMPOSANTS CL√âS", resonance: "V√âRIFICATION DE R√âSONANCE", instructions: "INSTRUCTIONS SYST√àME", fallback: "FALLBACK D'URGENCE", quality: "CRIT√àRES DE QUALIT√â", responseLang: "R√©ponds en FRAN√áAIS.", complexity: ["Faible","Moyenne","√âlev√©e"] },
      ptbr: { label: "üáßüá∑ Portugu√™s (BR)", protocolTitle: "IrsanAI-LRP v1.3 ‚Äì Protocolo", auto: "Documento LRP gerado automaticamente", metadata: "METADADOS", userRequest: "SOLICITA√á√ÉO DO USU√ÅRIO", components: "COMPONENTES-CHAVE", resonance: "CHECAGEM DE RESSON√ÇNCIA", instructions: "INSTRU√á√ïES DO SISTEMA", fallback: "FALLBACK DE EMERG√äNCIA", quality: "CRIT√âRIOS DE QUALIDADE", responseLang: "Responda em PORTUGU√äS (BR).", complexity: ["Baixa","M√©dia","Alta"] },
      hi: { label: "üáÆüá≥ ‡§π‡§ø‡§®‡•ç‡§¶‡•Ä", protocolTitle: "IrsanAI-LRP v1.3 ‚Äî ‡§™‡•ç‡§∞‡•ã‡§ü‡•ã‡§ï‡•â‡§≤", auto: "‡§∏‡•ç‡§µ‡§ö‡§æ‡§≤‡§ø‡§§ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§®‡§ø‡§∞‡•ç‡§Æ‡§ø‡§§ LRP ‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡§º", metadata: "‡§Æ‡•á‡§ü‡§æ‡§°‡•á‡§ü‡§æ", userRequest: "‡§Ø‡•Ç‡§ú‡§º‡§∞ ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß", components: "‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§ò‡§ü‡§ï", resonance: "‡§∞‡•á‡§ú‡§º‡•ã‡§®‡•á‡§Ç‡§∏ ‡§ú‡§æ‡§Å‡§ö", instructions: "‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§®‡§ø‡§∞‡•ç‡§¶‡•á‡§∂", fallback: "‡§á‡§Æ‡§∞‡§ú‡•á‡§Ç‡§∏‡•Ä ‡§´‡•â‡§≤‡§¨‡•à‡§ï", quality: "‡§ó‡•Å‡§£‡§µ‡§§‡•ç‡§§‡§æ ‡§Æ‡§æ‡§®‡§¶‡§Ç‡§°", responseLang: "‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§Æ‡•á‡§Ç ‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡•á‡§Ç‡•§", complexity: ["‡§®‡§ø‡§Æ‡•ç‡§®","‡§Æ‡§ß‡•ç‡§Ø‡§Æ","‡§â‡§ö‡•ç‡§ö"] },
      ja: { label: "üáØüáµ Êó•Êú¨Ë™û", protocolTitle: "IrsanAI-LRP v1.3 ‚Äî „Éó„É≠„Éà„Ç≥„É´", auto: "Ëá™ÂãïÁîüÊàê„Åï„Çå„ÅüLRP„Éâ„Ç≠„É•„É°„É≥„Éà", metadata: "„É°„Çø„Éá„Éº„Çø", userRequest: "„É¶„Éº„Ç∂„ÉºË¶ÅÊ±Ç", components: "„Ç≥„Ç¢„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà", resonance: "„É¨„Çæ„Éä„É≥„Çπ„ÉÅ„Çß„ÉÉ„ÇØ", instructions: "„Ç∑„Çπ„ÉÜ„É†ÊåáÁ§∫", fallback: "Á∑äÊÄ•„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ", quality: "ÂìÅË≥™Âü∫Ê∫ñ", responseLang: "Êó•Êú¨Ë™û„ÅßÂõûÁ≠î„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ", complexity: ["‰Ωé","‰∏≠","È´ò"] },
      tr: { label: "üáπüá∑ T√ºrk√ße", protocolTitle: "IrsanAI-LRP v1.3 ‚Äì Protokol", auto: "Otomatik olu≈üturulan LRP dok√ºmanƒ±", metadata: "METAVERƒ∞", userRequest: "KULLANICI TALEBƒ∞", components: "TEMEL Bƒ∞LE≈ûENLER", resonance: "REZONANS KONTROL√ú", instructions: "Sƒ∞STEM TALƒ∞MATLARI", fallback: "ACƒ∞L DURUM FALLBACK", quality: "KALƒ∞TE KRƒ∞TERLERƒ∞", responseLang: "T√úRK√áE yanƒ±t ver.", complexity: ["D√º≈ü√ºk","Orta","Y√ºksek"] }
    };

    const LLM_OPTIONS = [
      { id: "universal", title: "üåê Universal", desc: "F√ºr alle LLMs" },
      { id: "chatgpt", title: "üü¢ ChatGPT", desc: "OpenAI" },
      { id: "claude", title: "üü£ Claude", desc: "Anthropic" },
      { id: "gemini", title: "üîµ Gemini", desc: "Google" },
      { id: "qwen", title: "üü† Qwen", desc: "Alibaba" }
    ];

    let selectedLLM = "universal";

    const languageSelect = document.getElementById("language");
    const userPrompt = document.getElementById("userPrompt");

    Object.entries(LANGUAGES).forEach(([key, data]) => {
      const option = document.createElement("option");
      option.value = key;
      option.textContent = data.label;
      languageSelect.appendChild(option);
    });
    languageSelect.value = "de";

    const llmContainer = document.getElementById("llmOptions");
    LLM_OPTIONS.forEach((item, idx) => {
      const button = document.createElement("button");
      button.className = `llm-btn ${idx === 0 ? "active" : ""}`;
      button.dataset.llm = item.id;
      button.type = "button";
      button.innerHTML = `<strong>${item.title}</strong><br><small>${item.desc}</small>`;
      button.onclick = () => {
        document.querySelectorAll(".llm-btn").forEach((b) => b.classList.remove("active"));
        button.classList.add("active");
        selectedLLM = item.id;
      };
      llmContainer.appendChild(button);
    });

    document.getElementById("tokenBudget").addEventListener("input", (e) => {
      document.getElementById("tokenValue").textContent = e.target.value;
    });

    userPrompt.addEventListener("input", updateMetrics);
    updateMetrics();

    function updateMetrics() {
      const chars = userPrompt.value.length;
      const tokens = Math.ceil(chars / 4);
      const lang = LANGUAGES[languageSelect.value];
      const complexity = chars < 50 ? lang.complexity[0] : chars < 220 ? lang.complexity[1] : lang.complexity[2];
      document.getElementById("charCount").textContent = chars;
      document.getElementById("tokenEstimate").textContent = tokens;
      document.getElementById("complexity").textContent = complexity;
    }

    languageSelect.addEventListener("change", updateMetrics);

    function analyzePrompt() {
      const prompt = userPrompt.value.trim();
      if (!prompt) {
        alert("Bitte zuerst eine Anfrage eingeben.");
        return;
      }

      const hasCode = /code|app|programm|skript|website|software|api|dashboard|python|javascript/i.test(prompt);
      const hasHardware = /gpu|cpu|aufl√∂sung|performance|game|spiel|3d|hardware/i.test(prompt);
      const hasPersistence = /speicher|datenbank|save|persist|fortschritt|state|storage/i.test(prompt);
      const confidence = Math.min(96, 58 + prompt.length / 8 + (hasCode ? 8 : 0));
      const recommendedPath = (hasCode || hasHardware || hasPersistence) ? 2 : 1;

      document.getElementById("analysisResult").innerHTML = `
        <strong>${confidence.toFixed(0)}% Intent-Confidence</strong>
        <div class="progress"><div style="width:${confidence}%"></div></div>
        <div>${recommendedPath === 2 ? "‚ö†Ô∏è Empfehlung: Weg 2 (OS/HW-bewusst)" : "‚úÖ Empfehlung: Weg 1 (direkt)"}</div>
        <ul class="list">
          <li>${hasCode ? "‚úÖ" : "‚ùå"} Code-/Produktionsbezug</li>
          <li>${hasHardware ? "‚úÖ" : "‚ùå"} Hardware-/Performancebezug</li>
          <li>${hasPersistence ? "‚úÖ" : "‚ùå"} Persistenz-/Statebezug</li>
        </ul>
      `;
    }

    function generateLRP() {
      const prompt = userPrompt.value.trim();
      if (!prompt) {
        alert("Bitte zuerst eine Anfrage eingeben.");
        return;
      }

      const langKey = languageSelect.value;
      const lang = LANGUAGES[langKey];
      const tokenBudget = document.getElementById("tokenBudget").value;
      const intentConfidence = document.getElementById("intentConfidence").checked;
      const tokenOptimization = document.getElementById("tokenOptimization").checked;
      const emergencyFallback = document.getElementById("emergencyFallback").checked;
      const versionCheck = document.getElementById("versionCheck").checked;
      const timestamp = new Date().toISOString();
      const preSelectorMode = tokenOptimization && prompt.length < 110 ? "MINI" : "FULL";
      const taskId = `usr_${Date.now()}`;
      const uniq = Math.random().toString(36).slice(2, 10);

      const protocol = `# ${lang.protocolTitle}
*${lang.auto}*

## ${lang.metadata}
\`\`\`yaml
creator: "IrsanAI Web-UI v1.3"
timestamp: "${timestamp}"
protocol_version: "1.3"
llm_target: "${selectedLLM}"
language: "${langKey}"
token_budget: ${tokenBudget}
pre_selector_mode: "${preSelectorMode}"
task_id: "${taskId}"
unique_key: "${uniq}"
features:
  intent_confidence: ${intentConfidence}
  token_optimization: ${tokenOptimization}
  emergency_fallback: ${emergencyFallback}
  version_check: ${versionCheck}
\`\`\`

${versionCheck ? `> Version note: LRP v1.3 active.\n\n` : ""}## ${lang.userRequest}
\`\`\`text
${prompt}
\`\`\`

## ${lang.components}
1. Context Layer ‚Äî define stable facts, roles, and assumptions.
2. Task Layer ‚Äî restate the goal in one clear sentence.
3. Constraint Layer ‚Äî separate hard vs. soft constraints.
4. Output Format ‚Äî require exact response structure.

## ${lang.resonance}
1. Echo interpreted Context + Task + Constraints in <= 80 tokens.
2. Ask for clarification only if ambiguity remains.
3. Continue execution after confirmation.

## ${lang.instructions}
- Follow strict LRP structure.
- Do not alter the user request.
- ${lang.responseLang}
- If Path 2 is required, generate only environment detector first.
- Respect max token budget: ${tokenBudget}

${intentConfidence ? `- Include an intent-confidence score with top uncertainty factors.\n` : ""}${tokenOptimization ? `- Use token-efficient style and avoid unnecessary verbosity.\n` : ""}
${emergencyFallback ? `## ${lang.fallback}
If protocol compliance fails, return a concise error + reason + next step.

` : ""}## ${lang.quality}
‚úÖ Intent captured clearly
‚úÖ Technical rationale instead of keywords only
‚úÖ Resonance check executed before final answer
‚úÖ Output format respected

---
IrsanAI-LRP v1.3 | ${new Date().toLocaleString()}`;

      document.getElementById("output").textContent = protocol;
    }

    function copyToClipboard() {
      const text = document.getElementById("output").textContent;
      if (!text || text.includes("Hier erscheint")) return;
      navigator.clipboard.writeText(text);
    }
  </script>
</body>
</html>
